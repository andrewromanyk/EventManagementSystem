<!DOCTYPE html>
<html lang="ua"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Create user - Event Manager</title>
    <link rel="stylesheet" href="../static/styles/basic.css"
          th:href="@{styles/basic.css}">
    <link rel="stylesheet" href="../static/styles/forms.css"
          th:href="@{styles/forms.css}">
    <link rel="icon" href="../static/em-icon.png"
          th:href="@{/em-icon.png}">
</head>

<body>
<header>
    <h1 id=name>
        Event
        <br>
        Manager
    </h1>
    <img id=icon alt="Event Manager" src="../static/em-icon.png"
         th:src="@{/em-icon.png}">
</header>

<div class="fullOutside">
    <div class="mainText">
        <br>
        Login
    </div>
    <br>

    <form id="loginForm" th:action="@{/login}" method="POST" >

        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required minlength="1">
        <br>

        <label for="pass">Password:</label>
        <input type="password" id="pass" name="password" required minlength="1">
        <br>

        <button type="submit">Submit</button>
    </form>

</div>

<script>
    async function login(username, password) {
        // Create the request payload
        const loginData = {
            username: username,
            password: password
        };

        // Send the login request using fetch
        const response = await fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',  // Content type of the request
            },
            body: new URLSearchParams(loginData)  // Encode the data for the request
        });

        // Handle the response
        if (response.ok) {
            // const data = await response.json();  // Parse the JSON response
            //
            // const token = data.token;  // Assuming the token is returned as a JSON property
            // console.log('Received token:', token);
            //
            // // Save the token in localStorage (or sessionStorage)
            // localStorage.setItem('jwtToken', token);  // You can also use sessionStorage instead

            // Optionally, redirect or update UI
            window.location.href = '/main';  // Redirect after successful login
        } else {
            console.error('Login failed');
            alert('Login failed, please try again.');
        }
    }

    // Attach to the form submit event
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();  // Prevent default form submission

        const username = document.getElementById('username').value;
        const password = document.getElementById('pass').value;

        // Call the login function with the entered values
        login(username, password);
    });

</script>

<footer>
    <ul class="footerList">
        <li>
            <a href="/login">Main Site</a>
        </li>
        <li>
            <a href="/FAQ.html">FAQ</a>
        </li>
    </ul>
</footer>
</body>

</html>